@{
    ViewData["Title"] = "Contact Page";
}

<div class="text-center">
    <h1 class="display-4">Contact</h1>
    <p>Food recipes</p>
</div>

<div id="googleMapContainer" style="width: 500px; height: 500px">
</div>
@section scripts{
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=@ViewData["ApiKey"]"></script>
    <script type="text/javascript">$.ajax({
            url: '/api/Maps/JsonAddressList',
            type: 'GET',
            success: function (data) {
                var addresses = [];
                $.each(data, function (index, item) {
                    var address = {};
                    address["id"] = item.id;
                    address["latitude"] = item.latitude;
                    address["longitude"] = item.longitude;
                    address["name"] = item.name;
                    addresses.push(address);
                })
                initializeMap(addresses);

            }
        });


        function initializeMap(addresses) {
            console.log(addresses);
            var GoogleMapOptions = {
                center: new google.maps.LatLng(addresses[0].latitude, addresses[0].longitude),
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var infoWindow = new google.maps.InfoWindow();
            var map = new google.maps.Map(document.getElementById("googleMapContainer"), GoogleMapOptions);

            for (i = 0; i < addresses.length; i++) {
                var data = addresses[i]

                var myLatlng = new google.maps.LatLng(data.latitude, data.longitude);

                var address = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                    title: data.title
                });

                (function (address, data) {
                    google.maps.event.addListener(address, "click", function (e) {
                        infoWindow.setContent(data.name);
                        infoWindow.open(map, address);
                    });
                })(address, data);
            }
        }</script>

    }